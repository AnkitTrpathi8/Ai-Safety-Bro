<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="AI Safety Bro for Women - Real-time stress detection, SOS alerts, safer routes, and on-device chatbot assistance.">
  <title>AI Safety Bro for Women</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
  <style>
    :root {
      --primary: #39961d;
      --secondary: #7e22ce;
      --accent: #d946ef;
      --light: #faf5ff;
      --dark: #0f172a;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gray: #64748b;
      --card-bg: rgba(255, 255, 255, 0.05);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--light);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Header Styles */
    header {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      color: var(--accent);
      font-size: 2rem;
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(to right, #d946ef, #7e22ce);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 2rem;
    }

    nav a {
      color: var(--light);
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 0;
      position: relative;
      transition: var(--transition);
    }

    nav a:hover {
      color: var(--accent);
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--accent);
      transition: var(--transition);
    }

    nav a:hover::after {
      width: 100%;
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: var(--light);
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* Hero Section */
    .hero {
      min-height: 80vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 4rem 2rem;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%, rgba(126, 34, 206, 0.1), transparent 70%);
    }

    .hero h1 {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #f0abfc, #d946ef);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hero p {
      font-size: 1.25rem;
      max-width: 700px;
      margin-bottom: 2rem;
      color: #cbd5e1;
    }

    .hero-buttons {
      display: flex;
      gap: 1rem;
      margin-bottom: 3rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(to right, #7e22ce, #d946ef);
      color: white;
      box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(126, 34, 206, 0.4);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .feature-card {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 16px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: var(--transition);
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: var(--accent);
    }

    /* Main Content Sections */
    section {
      padding: 5rem 2rem;
    }

    .section-title {
      text-align: center;
      margin-bottom: 3rem;
      font-size: 2.5rem;
    }

    .section-title span {
      background: linear-gradient(to right, #d946ef, #7e22ce);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 900px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    button {
      background: linear-gradient(to right, #7e22ce, #d946ef);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Meter */
    .meter-wrap {
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin: 1rem 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .meter {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
      transition: width 0.3s ease;
    }

    /* Form Elements */
    input, textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(15, 23, 42, 0.5);
      color: var(--light);
      margin-bottom: 1rem;
      transition: var(--transition);
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(217, 70, 239, 0.2);
    }

    /* Toggle Switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--gray);
      transition: var(--transition);
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: var(--transition);
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--success);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    /* Map */
    #map {
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin: 1rem 0;
    }

    /* Chat */
    .chat {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .chat-window {
      height: 300px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1rem;
      overflow-y: auto;
      background: rgba(15, 23, 42, 0.3);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .msg {
      padding: 0.75rem 1rem;
      border-radius: 12px;
      max-width: 80%;
      line-height: 1.4;
    }

    .msg.user {
      background: linear-gradient(to right, #7e22ce, #d946ef);
      align-self: flex-end;
    }

    .msg.bot {
      background: rgba(255, 255, 255, 0.1);
      align-self: flex-start;
    }

    .chat-input {
      display: flex;
      gap: 0.5rem;
    }

    .chat-input input {
      margin-bottom: 0;
    }

    /* Footer */
    footer {
      background: rgba(15, 23, 42, 0.8);
      padding: 3rem 2rem;
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      text-align: left;
    }

    .footer-logo {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #d946ef, #7e22ce);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .footer-links h3 {
      margin-bottom: 1rem;
      color: var(--light);
    }

    .footer-links ul {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 0.5rem;
    }

    .footer-links a {
      color: var(--gray);
      text-decoration: none;
      transition: var(--transition);
    }

    .footer-links a:hover {
      color: var(--accent);
    }

    .social-links {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .social-links a {
      color: var(--light);
      font-size: 1.5rem;
      transition: var(--transition);
    }

    .social-links a:hover {
      color: var(--accent);
    }

    .copyright {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--gray);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      header {
        padding: 1rem;
      }

      nav ul {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: rgba(15, 23, 42, 0.95);
        flex-direction: column;
        padding: 1rem;
        gap: 0;
        backdrop-filter: blur(10px);
      }

      nav ul.active {
        display: flex;
      }

      nav ul li {
        margin: 0.5rem 0;
      }

      .mobile-menu-btn {
        display: block;
      }

      .hero h1 {
        font-size: 2.5rem;
      }

      .hero p {
        font-size: 1.1rem;
      }

      .hero-buttons {
        flex-direction: column;
      }

      .section-title {
        font-size: 2rem;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 1s ease forwards;
    }

    .delay-1 { animation-delay: 0.2s; }
    .delay-2 { animation-delay: 0.4s; }
    .delay-3 { animation-delay: 0.6s; }

    /* SOS Button Animation */
    .sos-pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo">
      <i class="fas fa-shield-alt logo-icon"></i>
      <span class="logo-text">AI Safety Bro</span>
    </div>
    <nav>
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
      </button>
      <ul id="navMenu">
        <li><a href="#home">Home</a></li>
        <li><a href="#features">Features</a></li>
        <li><a href="#voice-monitor">Voice Monitor</a></li>
        <li><a href="#sos">SOS</a></li>
        <li><a href="#routes">Safe Routes</a></li>
        <li><a href="#chatbot">Chatbot</a></li>
        <li><a href="#about">About</a></li>
      </ul>
    </nav>
  </header>

  <!-- Hero Section -->
  <section class="hero" id="home">
    <h1 class="fade-in">Your AI-Powered Safety Companion</h1>
    <p class="fade-in delay-1">Real-time stress detection • Instant SOS alerts • Safer routes • On-device chatbot assistance</p>
    <div class="hero-buttons fade-in delay-2">
      <a href="#features" class="btn btn-primary"><i class="fas fa-star"></i> Explore Features</a>
      <a href="#sos" class="btn btn-secondary"><i class="fas fa-download"></i> Get Started</a>
    </div>
    <div class="features-grid">
      <div class="feature-card fade-in delay-1">
        <i class="fas fa-microphone feature-icon"></i>
        <h3>Voice Stress Monitor</h3>
        <p>Real-time analysis of vocal patterns to detect stress and danger</p>
      </div>
      <div class="feature-card fade-in delay-2">
        <i class="fas fa-bell feature-icon"></i>
        <h3>Instant SOS</h3>
        <p>Quickly alert trusted contacts with your location</p>
      </div>
      <div class="feature-card fade-in delay-3">
        <i class="fas fa-route feature-icon"></i>
        <h3>Safe Routes</h3>
        <p>Find the safest paths based on real-time data</p>
      </div>
      <div class="feature-card fade-in">
        <i class="fas fa-comments feature-icon"></i>
        <h3>Safety Chatbot</h3>
        <p>Get instant advice and information about safety</p>
      </div>
    </div>
  </section>

  <!-- Voice Stress Monitor Section -->
  <section id="voice-monitor" class="fade-in">
    <div class="container">
      <h2 class="section-title"><span>Voice Stress</span> Monitor</h2>
      <div class="card">
        <div class="grid-2">
          <div>
            <h3><i class="fas fa-microphone"></i> Real-time Stress Detection</h3>
            <p>Press Start and speak normally. If elevated stress is detected for a few seconds, SOS can auto-trigger.</p>
            <div class="controls">
              <button id="btnStart"><i class="fas fa-play"></i> Start</button>
              <button id="btnStop" disabled><i class="fas fa-stop"></i> Stop</button>
              <label class="switch">
                <input type="checkbox" id="autoSOS" />
                <span class="slider"></span>
              </label>
              <span>Auto SOS</span>
            </div>
            <div class="meter-wrap">
              <div id="stressMeter" class="meter"></div>
            </div>
            <p id="stressLabel">Stress Level: 0%</p>
            <small>Heuristic uses intensity + spectral features locally. For production, connect to a trained SER model.</small>
          </div>
          <div>
            <h3><i class="fas fa-info-circle"></i> How It Works</h3>
            <p>Our AI analyzes various vocal characteristics in real-time:</p>
            <ul>
              <li>Voice pitch and tone variations</li>
              <li>Speech rate and rhythm changes</li>
              <li>Volume and intensity fluctuations</li>
              <li>Spectral features for stress patterns</li>
            </ul>
            <div class="card" style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">
              <h4><i class="fas fa-exclamation-triangle"></i> Privacy First</h4>
              <p>All audio processing happens locally on your device. No voice data is ever sent to external servers.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SOS Section -->
  <section id="sos" style="background: rgba(239, 68, 68, 0.05);">
    <div class="container">
      <h2 class="section-title">Emergency <span>SOS</span> System</h2>
      <div class="card">
        <div class="grid-2">
          <div>
            <h3><i class="fas fa-bell"></i> Quick SOS Alert</h3>
            <p>Send your live location to trusted contacts instantly in case of emergency.</p>
            <div class="sos">
              <input id="contact1" placeholder="Primary contact (e.g., +91xxxxxxxxxx)" />
              <input id="contact2" placeholder="Secondary contact (optional)" />
              <textarea id="sosMsg" placeholder="Optional message (e.g., I need help)" rows="3"></textarea>
              <button id="btnSOS" class="sos-pulse"><i class="fas fa-bell"></i> Send SOS</button>
              <p id="sosStatus" class="muted"></p>
            </div>
          </div>
          <div>
            <h3><i class="fas fa-users"></i> Trusted Contacts</h3>
            <p>Manage your emergency contacts who will receive alerts:</p>
            <div class="card" style="margin-bottom: 1rem;">
              <h4><i class="fas fa-user"></i> Primary Contact</h4>
              <p id="primaryContactDisplay">Not set</p>
            </div>
            <div class="card">
              <h4><i class="fas fa-user"></i> Secondary Contact</h4>
              <p id="secondaryContactDisplay">Not set</p>
            </div>
            <button id="btnSaveContacts" style="margin-top: 1rem; background: var(--success);">
              <i class="fas fa-save"></i> Save Contacts
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Safe Routes Section -->
  <section id="routes">
    <div class="container">
      <h2 class="section-title"><span>Safe Route</span> Planner</h2>
      <div class="card">
        <h3><i class="fas fa-route"></i> Safest Route (Beta)</h3>
        <p>Pick start and end points on the map. We'll find the safest path based on proximity to risk hotspots.</p>
        <div class="controls">
          <button id="btnUseMyLocation"><i class="fas fa-location-arrow"></i> Use My Location</button>
          <button id="btnClear"><i class="fas fa-trash"></i> Clear</button>
          <label><input type="checkbox" id="showHeat" checked /> Show risk areas</label>
        </div>
        <div id="map"></div>
        <div id="routeInfo" class="muted"></div>
      </div>
    </div>
  </section>

  <!-- Chatbot Section -->
  <section id="chatbot" style="background: rgba(126, 34, 206, 0.05);">
    <div class="container">
      <h2 class="section-title">Safety <span>Chatbot</span></h2>
      <div class="card">
        <div class="grid-2">
          <div>
            <h3><i class="fas fa-comments"></i> AI Safety Assistant</h3>
            <p>Get instant answers to safety questions, legal information, and app guidance.</p>
            <div class="chat">
              <div id="chatWindow" class="chat-window">
                <div class="msg bot">
                  <strong>Bro:</strong> Hello! I'm your safety assistant. How can I help you today?
                </div>
              </div>
              <div class="chat-input">
                <input id="chatText" placeholder="Ask about safety, legal rights, how to use the app…" />
                <button id="chatSend"><i class="fas fa-paper-plane"></i></button>
              </div>
            </div>
          </div>
          <div>
            <h3><i class="fas fa-lightbulb"></i> Try Asking Me</h3>
            <div class="card" style="cursor: pointer;" onclick="document.getElementById('chatText').value = 'How does the SOS feature work?'; document.getElementById('chatSend').click();">
              <p>"How does the SOS feature work?"</p>
            </div>
            <div class="card" style="cursor: pointer;" onclick="document.getElementById('chatText').value = 'What are my legal rights?'; document.getElementById('chatSend').click();">
              <p>"What are my legal rights?"</p>
            </div>
            <div class="card" style="cursor: pointer;" onclick="document.getElementById('chatText').value = 'How to stay safe while walking at night?'; document.getElementById('chatSend').click();">
              <p>"How to stay safe while walking at night?"</p>
            </div>
            
            <h3 style="margin-top: 2rem;"><i class="fas fa-shield-alt"></i> Privacy & Security</h3>
            <ul>
              <li>All audio analysis is done locally in your browser (no upload) by default.</li>
              <li>SOS via Twilio is server-side with minimal data (contacts, location, message).</li>
              <li>Hotspots are demo data—replace with real open data for your city.</li>
              <li>Chat conversations are not stored on any server.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div>
        <div class="footer-logo">AI Safety Guardian</div>
        <p>Your AI-powered safety companion for everyday protection and peace of mind.</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-github"></i></a>
        </div>
      </div>
      <div class="footer-links">
        <h3>Features</h3>
        <ul>
          <li><a href="#voice-monitor">Voice Stress Monitor</a></li>
          <li><a href="#sos">Emergency SOS</a></li>
          <li><a href="#routes">Safe Routes</a></li>
          <li><a href="#chatbot">Safety Chatbot</a></li>
        </ul>
      </div>
      <div class="footer-links">
        <h3>Resources</h3>
        <ul>
          <li><a href="#">How to Use</a></li>
          <li><a href="#">Safety Tips</a></li>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Terms of Service</a></li>
        </ul>
      </div>
      <div class="footer-links">
        <h3>Contact</h3>
        <ul>
          <li><a href="mailto:support@aisafetybro.com">support@aisafetybro.com</a></li>
          <li><a href="#">Help Center</a></li>
          <li><a href="#">Report an Issue</a></li>
          <li><a href="#">Request a Feature</a></li>
        </ul>
      </div>
    </div>
    <div class="copyright">
      <p>Built for "AI for Societal Good" — demo stack: WebAudio + Leaflet + OSRM + Flask + Twilio</p>
      <p>© 2023 AI Safety Bro. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // ===== DOM Ready =====
    document.addEventListener('DOMContentLoaded', function() {
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const navMenu = document.getElementById('navMenu');
      
      mobileMenuBtn.addEventListener('click', function() {
        navMenu.classList.toggle('active');
      });
      
      // Close menu when clicking outside
      document.addEventListener('click', function(event) {
        if (!event.target.closest('nav') && navMenu.classList.contains('active')) {
          navMenu.classList.remove('active');
        }
      });
      
      // Smooth scrolling for navigation links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('href');
          if (targetId === '#') return;
          
          const targetElement = document.querySelector(targetId);
          if (targetElement) {
            // Close mobile menu if open
            navMenu.classList.remove('active');
            
            window.scrollTo({
              top: targetElement.offsetTop - 80,
              behavior: 'smooth'
            });
          }
        });
      });
      
      // Save contacts functionality
      const btnSaveContacts = document.getElementById('btnSaveContacts');
      const primaryContactDisplay = document.getElementById('primaryContactDisplay');
      const secondaryContactDisplay = document.getElementById('secondaryContactDisplay');
      
      btnSaveContacts.addEventListener('click', function() {
        const contact1 = document.getElementById('contact1').value.trim();
        const contact2 = document.getElementById('contact2').value.trim();
        
        if (contact1) {
          primaryContactDisplay.textContent = contact1;
          localStorage.setItem('primaryContact', contact1);
        }
        
        if (contact2) {
          secondaryContactDisplay.textContent = contact2;
          localStorage.setItem('secondaryContact', contact2);
        }
        
        alert('Contacts saved successfully!');
      });
      
      // Load saved contacts
      const savedPrimaryContact = localStorage.getItem('primaryContact');
      const savedSecondaryContact = localStorage.getItem('secondaryContact');
      
      if (savedPrimaryContact) {
        document.getElementById('contact1').value = savedPrimaryContact;
        primaryContactDisplay.textContent = savedPrimaryContact;
      }
      
      if (savedSecondaryContact) {
        document.getElementById('contact2').value = savedSecondaryContact;
        secondaryContactDisplay.textContent = savedSecondaryContact;
      }
    });

    // ===== Utility: Toast/append messages =====
    function appendChat(role, text){
      const w = document.getElementById('chatWindow');
      const div = document.createElement('div');
      div.className = 'msg ' + role;
      div.innerHTML = `<strong>${role === 'user' ? 'You' : 'Bro'}:</strong> ${text}`;
      w.appendChild(div); 
      w.scrollTop = w.scrollHeight;
    }

    // ===== 1) VOICE STRESS HEURISTIC (client-side) =====
    let audioCtx, analyser, micSrc, dataArray, running=false, stressLevel=0, stressStreak=0;
    const btnStart = document.getElementById('btnStart');
    const btnStop = document.getElementById('btnStop');
    const stressMeter = document.getElementById('stressMeter');
    const stressLabel = document.getElementById('stressLabel');
    const autoSOS = document.getElementById('autoSOS');

    btnStart.onclick = async () => {
      try{
        const stream = await navigator.mediaDevices.getUserMedia({audio:true});
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 1024;
        micSrc = audioCtx.createMediaStreamSource(stream);
        micSrc.connect(analyser);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        running = true; 
        btnStart.disabled = true; 
        btnStop.disabled = false;
        loopAnalyze();
      }catch(e){
        alert('Microphone permission denied: ' + e.message);
      }
    };

    btnStop.onclick = () => { 
      running=false; 
      btnStart.disabled=false; 
      btnStop.disabled=true; 
      stressMeter.style.width='0%'; 
      stressLabel.textContent='Stress Level: 0%'; 
    };

    function loopAnalyze(){
      if(!running) return;
      analyser.getByteFrequencyData(dataArray);
      
      // Compute simple spectral/energy features
      let sum=0, maxv=0, centroidNum=0, centroidDen=0;
      for(let i=0;i<dataArray.length;i++){
        const v=dataArray[i];
        sum+=v; 
        if(v>maxv) maxv=v; 
        centroidNum+=i*v; 
        centroidDen+=v;
      }
      const energy = sum / dataArray.length;
      const centroid = centroidDen>0 ? (centroidNum/centroidDen)/dataArray.length : 0;
      
      // Normalize to [0,100]
      const energyP = Math.min(100, (energy/255)*120);
      const brightP = Math.min(100, centroid*130);
      
      // Combined stress (heuristic)
      stressLevel = Math.round(0.65*energyP + 0.35*brightP);
      stressMeter.style.width = Math.min(100, stressLevel)+'%';
      stressLabel.textContent = `Stress Level: ${Math.min(100, stressLevel)}%`;

      // streak logic: if stress > 70 for ~3 seconds, mark as high
      if(stressLevel>70){
        stressStreak++;
        if(stressStreak>60 && autoSOS.checked){
          triggerSOS('Auto stress detected');
          stressStreak=0;
        }
      }else{ 
        stressStreak=0; 
      }

      requestAnimationFrame(loopAnalyze);
    }

    // ===== 2) SOS via backend + graceful fallback =====
    const sosStatus = document.getElementById('sosStatus');
    
    async function triggerSOS(reason){
      const contact1 = document.getElementById('contact1').value.trim();
      const contact2 = document.getElementById('contact2').value.trim();
      const msg = document.getElementById('sosMsg').value.trim() || 'I need help. Please reach me fast.';
      
      if(!contact1){ 
        alert('Add at least one contact number (E.164 format, e.g., +91xxxxxxxxxx)'); 
        return; 
      }
      
      sosStatus.textContent = 'Fetching location…';
      
      try{
        const pos = await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej,{enableHighAccuracy:true,timeout:10000}));
        const {latitude, longitude} = pos.coords;
        const mapsLink = `https://maps.google.com/?q=${latitude},${longitude}`;
        const fullMessage = `${msg}\nReason: ${reason||'Manual SOS'}\nLocation: ${mapsLink}`;

        // Try backend Twilio SMS
        const r = await fetch('/api/sos',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({contacts:[contact1, contact2].filter(Boolean), message: fullMessage})
        });

        if(r.ok){
          const data = await r.json();
          sosStatus.textContent = `SOS sent to ${data.sent.join(', ')}.`;
        }else{
          // Fallback: open SMS composer
          sosStatus.textContent = 'Backend unavailable. Opening SMS composer…';
          window.location.href = `sms:${encodeURIComponent(contact1)}&body=${encodeURIComponent(fullMessage)}`;
        }
      }catch(e){
        sosStatus.textContent = 'Location denied/unavailable. Opening SMS composer…';
        const fallbackMsg = (document.getElementById('sosMsg').value.trim()||'I need help') + ' (Location unavailable)';
        window.location.href = `sms:${encodeURIComponent(contact1)}&body=${encodeURIComponent(fallbackMsg)}`;
      }
    }

    document.getElementById('btnSOS').onclick = ()=>triggerSOS('Manual SOS');

    // ===== 3) Map + Hotspots + OSRM safest route =====
    let map, startMarker=null, endMarker=null, routeLayer=null, heatLayer=null, hotspotData=null;
    const routeInfo = document.getElementById('routeInfo');

    window.addEventListener('load', async ()=>{
      map = L.map('map').setView([28.6139,77.2090], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap'}).addTo(map);

      // Load hotspots geojson
      try{
        const res = await fetch('/hotspots');
        hotspotData = await res.json();
        drawHotspotHeat(hotspotData);
      }catch(e){ console.warn('No hotspots data', e); }

      map.on('click', (e)=>{
        if(!startMarker){
          startMarker = L.marker(e.latlng,{draggable:true}).addTo(map).bindPopup('Start').openPopup();
          startMarker.on('dragend', planRoute);
        }else if(!endMarker){
          endMarker = L.marker(e.latlng,{draggable:true}).addTo(map).bindPopup('End').openPopup();
          endMarker.on('dragend', planRoute);
          planRoute();
        }else{
          // reset with new start
          map.removeLayer(startMarker); 
          map.removeLayer(endMarker);
          startMarker = L.marker(e.latlng,{draggable:true}).addTo(map).bindPopup('Start').openPopup();
          startMarker.on('dragend', planRoute);
          endMarker = null; 
          if(routeLayer){ 
            map.removeLayer(routeLayer); 
            routeLayer=null; 
          }
        }
      });

      document.getElementById('btnUseMyLocation').onclick = async ()=>{
        try{
          const pos = await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej,{enableHighAccuracy:true,timeout:10000}));
          const ll = [pos.coords.latitude, pos.coords.longitude];
          map.setView(ll, 15);
          if(!startMarker){
            startMarker = L.marker(ll,{draggable:true}).addTo(map).bindPopup('Start').openPopup();
            startMarker.on('dragend', planRoute);
          }else{
            startMarker.setLatLng(ll);
          }
        }catch(e){ alert('Location permission denied'); }
      };

      document.getElementById('btnClear').onclick = ()=>{
        if(startMarker){ map.removeLayer(startMarker); startMarker=null; }
        if(endMarker){ map.removeLayer(endMarker); endMarker=null; }
        if(routeLayer){ map.removeLayer(routeLayer); routeLayer=null; }
        routeInfo.textContent = '';
      };

      document.getElementById('showHeat').onchange = (e)=>{
        if(!hotspotData) return;
        if(e.target.checked){ 
          drawHotspotHeat(hotspotData); 
        } else { 
          if(heatLayer){ 
            map.removeLayer(heatLayer); 
            heatLayer=null; 
          } 
        }
      };
    });

    function drawHotspotHeat(geojson){
      if(heatLayer){ 
        map.removeLayer(heatLayer); 
        heatLayer=null; 
      }
      
      // naive heat using circles
      heatLayer = L.layerGroup();
      geojson.features.forEach(f=>{
        const [lng,lat] = f.geometry.coordinates;
        const r = 60 + (f.properties.risk||1)*40;
        const c = f.properties.risk>=3? '#ef4444' : (f.properties.risk==2? '#f59e0b' : '#22c55e');
        L.circle([lat,lng],{radius:r,color:c,fillColor:c,fillOpacity:0.25,weight:1}).addTo(heatLayer);
      });
      heatLayer.addTo(map);
    }

    async function planRoute(){
      if(!startMarker || !endMarker) return;
      routeInfo.textContent = 'Fetching candidate routes…';
      const s = startMarker.getLatLng();
      const e = endMarker.getLatLng();
      
      // OSRM public demo server
      const url = `https://router.project-osrm.org/route/v1/foot/${s.lng},${s.lat};${e.lng},${e.lat}?overview=full&geometries=geojson&alternatives=true`;
      
      try{
        const r = await fetch(url);
        const data = await r.json();
        if(!data.routes || !data.routes.length){ 
          routeInfo.textContent = 'No route found.'; 
          return; 
        }

        // Score each route by proximity to hotspots
        const scored = data.routes.map(rt=>({
          route: rt,
          score: safetyScore(rt.geometry)
        }));
        scored.sort((a,b)=> b.score - a.score);

        const best = scored[0];
        if(routeLayer){ 
          map.removeLayer(routeLayer); 
          routeLayer=null; 
        }
        
        routeLayer = L.geoJSON(best.route.geometry,{style:{weight:5,opacity:0.9}}).addTo(map);
        map.fitBounds(routeLayer.getBounds(),{padding:[30,30]});

        const distKm = (best.route.distance/1000).toFixed(2);
        const durMin = Math.round(best.route.duration/60);
        routeInfo.textContent = `Selected safest route • Distance: ${distKm} km • Duration: ${durMin} min`;
      }catch(e){ 
        routeInfo.textContent = 'Routing service unavailable.'; 
      }
    }

    function safetyScore(geometry){
      if(!hotspotData) return 0;
      const coords = geometry.coordinates;
      let score = 0;
      
      for(const f of hotspotData.features){
        const [hlng, hlat] = f.geometry.coordinates;
        const risk = f.properties.risk || 1;
        let minD = Infinity;
        
        for(const c of coords){
          const d = haversine(hlat,hlng,c[1],c[0]);
          if(d<minD) minD=d;
        }
        
        const s = Math.max(0, 1.5 - minD) * (-risk) + Math.min(1, minD/1.5) * 0.2;
        score += s;
      }
      
      return -score;
    }

    function haversine(lat1,lon1,lat2,lon2){
      const R = 6371;
      const toRad = x=>x*Math.PI/180;
      const dLat = toRad(lat2-lat1), dLon=toRad(lon2-lon1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(a));
    }

    // ===== 4) Rule-based chatbot =====
    const BOT_KB = [
      {q:["help","sos","panic"], a:"Tap Send SOS or enable Auto SOS. Add trusted contacts. The app shares your live location via SMS."},
      {q:["legal","rights","police"], a:"You have the right to file an FIR at any police station (Zero FIR). Ask for a copy. Use helplines like 1091 (women), 112 (ER)."},
      {q:["route","safe","walk","night"], a:"Prefer well-lit main roads, avoid isolated shortcuts, share live location, and keep your phone accessible."},
      {q:["privacy","data"], a:"Audio is analyzed locally. Only SOS sends contacts + location to the server for SMS. You control it."},
      {q:["hotspot","crime","map"], a:"Hotspots are illustrative. Replace data/data.geojson with your city's open data for better accuracy."},
      {q:["how","use"], a:"1) Start monitor\n2) Add contacts\n3) Click map for start & end\n4) Send SOS if needed. That's it!"}
    ];

    function botReply(txt){
      const t = txt.toLowerCase();
      let best=null, score=0;
      
      for(const item of BOT_KB){
        let s=0; 
        for(const k of item.q){ 
          if(t.includes(k)) s++; 
        }
        if(s>score){ 
          score=s; 
          best=item; 
        }
      }
      
      return best ? best.a : "I didn't get that fully. Ask about: SOS, legal rights, safe routes, privacy, or how to use the app.";
    }

    document.getElementById('chatSend').onclick = ()=>{
      const input = document.getElementById('chatText');
      const t = input.value.trim(); 
      if(!t) return;
      
      appendChat('user', t);
      const a = botReply(t);
      
      setTimeout(()=>appendChat('bot', a), 200);
      input.value='';
    };

    // Allow sending message with Enter key
    document.getElementById('chatText').addEventListener('keypress', function(e){
      if(e.key === 'Enter'){
        document.getElementById('chatSend').click();
      }
    });
  </script>
</body>
</html>